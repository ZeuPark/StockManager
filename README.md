# StockManager

## Intraday Stock Trading & Backtesting System

**Author:** Zeu Park  
**Email:** parkzeu68

---

StockManager is a Python-based framework for real-time intraday trading and strategy backtesting, designed for the Korean stock market. It features event-driven backtesting, advanced analytics, and a robust real-time trading engine. This project is ideal for portfolio demonstration, showcasing both algorithmic trading and quantitative research skills.

---

## 🚀 Key Features

### 1. Real-Time Trading System
- **WebSocket-based real-time data streaming**
- **Automated order execution** based on strategy signals
- **Live risk management** (position sizing, stop-loss, trailing stop)
- **API integration** with Korea Investment & Securities

### 2. Strategy Backtesting
- **Event-driven backtesting** using 1-minute bar data
- **Multiple strategies supported** (e.g., Gap and Go, Trend Following)
- **Dynamic risk management** (trailing stop, position sizing)
- **Market regime filter** based on KOSPI index
- **Realistic trading cost modeling** (commission, tax, slippage)

### 3. Advanced Analytics
- **Walk-forward optimization** to prevent overfitting
- **Parameter sensitivity analysis**
- **Batch backtesting** for robustness
- **Performance monitoring** (real-time and historical)

---

## 📁 Project Structure

```
StockManager/
├── main.py                  # Entry point for CLI and orchestration
├── account/                 # Account monitoring and management modules
├── analysis/                # Strategy analytics, visualization, and batch analysis
├── api/                     # API clients for brokerage and data (REST, WebSocket)
├── config/                  # Project-wide configuration and settings
├── core/                    # Core trading logic, backtesting, optimization, and real-time engine
├── data_collection/         # Data collection scripts and market data utilities
├── database/                # Database schema, initialization, and management
├── deployment/              # Docker and deployment configs
├── docs/                    # Documentation, strategy guides, and flow diagrams
├── logs/                    # Log files (auto-generated)
├── minute_data/             # 1-minute bar data storage (external or generated)
├── monitor/                 # Real-time monitoring, metrics, and alerting
├── monitoring/              # Prometheus and monitoring configs
├── news_trading/            # News-based trading strategies and crawlers
├── nginx/                   # Nginx reverse proxy configuration
├── orders/                  # Order management and signal processing
├── tests/                   # Unit and integration tests
├── trading/                 # Trading simulators and strategy runners
├── utils/                   # Utility modules (indicators, logging, tokens)
└── requirements.txt         # Python dependencies
```

### Directory Descriptions

- **main.py**: Unified entry point for running backtests, real-time trading, or utilities.
- **account/**: Account monitoring, balance tracking, and account-related utilities.
- **analysis/**: Tools for analyzing strategies, visualizing results, and running batch analytics.
- **api/**: Interfaces for connecting to brokerage APIs (REST/WebSocket) and data providers.
- **config/**: Centralized configuration files and settings for the project.
- **core/**: Core trading engine, backtesting logic, parameter optimization, and real-time trading modules.
- **data_collection/**: Scripts and modules for collecting historical and real-time market data.
- **database/**: Database schema, initialization scripts, and management utilities for storing trades and analytics.
- **deployment/**: Docker and deployment-related configuration for production or cloud environments.
- **docs/**: Documentation, strategy explanations, project flowcharts, and example results.
- **logs/**: Directory for log outputs (created automatically during runs).
- **minute_data/**: Storage for 1-minute bar data (external or generated by data collectors).
- **monitor/**: Real-time monitoring scripts, Prometheus metrics exporters, and alerting tools.
- **monitoring/**: Prometheus and monitoring configuration files.
- **news_trading/**: News-based trading strategies, crawlers, and related backtesting tools.
- **nginx/**: Nginx configuration for reverse proxying dashboards or APIs.
- **orders/**: Order management, signal processing, and execution logic.
- **tests/**: Unit and integration tests for all major modules.
- **trading/**: Trading simulators and strategy execution scripts.
- **utils/**: Utility functions, technical indicators, logging, and token management.
- **requirements.txt**: List of Python dependencies for the project.

---

## 🛠️ Technical Stack & Implementation Details

### 1. **Python-Based Architecture**
- **Primary Language:** Python 3.x  
  Used for all aspects including data analysis, real-time processing, backtesting, and API integration.

### 2. **Real-Time Data Processing**
- **WebSocket Client:**  
  Asynchronous WebSocket communication for real-time market data streaming and event-driven trading signal processing, implemented in `api/websocket_client.py`.
- **REST API Integration:**  
  REST client for brokerage APIs (e.g., Korea Investment & Securities) to handle order placement, account balance, and trade history in both real-time and batch modes.

### 3. **Event-Driven Trading Engine**
- **Event-driven Architecture:**  
  The entire trading flow—data reception, signal generation, order execution, and position management—is handled via event-driven modules (see `core/real_time_trading.py`).

### 4. **Strategy Backtesting & Optimization**
- **1-Minute Bar Backtesting:**  
  High-resolution backtesting using 1-minute OHLCV data (see `core/backtest_gradual_riser.py`).
- **Walk-forward Optimization:**  
  Prevents overfitting by optimizing and validating parameters on rolling windows (`core/parameter_optimizer.py`).
- **Batch Backtesting:**  
  Automated evaluation of multiple parameter/strategy combinations for robustness.

### 5. **Advanced Analytics & Visualization**
- **Performance Analysis:**  
  Calculates metrics such as return, MDD, Sharpe ratio, and more. Visualization tools in `analysis/analysis_visualizer.py`.
- **Parameter Sensitivity Analysis:**  
  Evaluates how strategy performance changes with parameter variations.

### 6. **Risk & Position Management**
- **Automated Position Sizing, Stop Loss/Take Profit, Trailing Stop:**  
  Applied in both real-time trading and backtesting.
- **Market Regime Filtering:**  
  Uses KOSPI or other index-based filters to adapt trading to market conditions.

### 7. **Data Collection & Management**
- **Automated Data Collection Scripts:**  
  Various collectors in `data_collection/` for historical and real-time data.
- **Database Management:**  
  Lightweight database (e.g., SQLite) for storing trades and analytics, with schema and initialization scripts in `database/`.

### 8. **Modularity & Extensibility**
- **Separation of Concerns:**  
  Clear directory structure for strategies, data, orders, monitoring, and utilities.
- **Unit & Integration Testing:**  
  Comprehensive tests for all major modules in `tests/`.

### 9. **Deployment & Operations**
- **Dockerized Deployment:**  
  Easy environment setup using Dockerfile and docker-compose in `deployment/`.
- **Nginx Reverse Proxy:**  
  Proxy support for dashboards and monitoring services.

### 10. **Monitoring & Logging**
- **Prometheus Metrics Exporter:**  
  Real-time metrics collection and integration with external monitoring tools.
- **Logging System:**  
  Centralized logging via `utils/logger.py` for auditability and debugging.

---

## 🛠️ Installation

1. **Clone the repository:**
```bash
git clone https://github.com/yourusername/StockManager.git
cd StockManager
```

2. **Install dependencies:**
```bash
pip install -r requirements.txt
```

3. **Prepare data:**
- Collect 1-minute bar data and KOSPI index data using provided scripts in `data_collection/`.

4. **Configure API (for live trading):**
- Edit `api_config.json` with your API credentials.

---

## 📊 Usage Examples

### 1. Run a Basic Backtest
```bash
python backtest_gradual_riser.py
```

### 2. Batch Backtesting
```bash
python multi_experiment.py --repeat 10
```

### 3. Walk-Forward Optimization
```bash
python parameter_optimizer.py --walk-forward
```

### 4. Real-Time Trading
```bash
python core/real_time_trading.py
```

---

## 📈 Example Results

### Backtest Performance Graph
![Backtest Example](docs/example_backtest_result.png)

### Real-Time Trading Dashboard (Sample)
![Real-Time Dashboard](docs/example_realtime_dashboard.png)


---

## 🧠 Strategies Overview

### Gap and Go
- **Goal:** Capture early-morning momentum from opening price gaps and volume spikes
- **Logic:**
  - Opening gap > 0.2%
  - Volume > 30,000 shares at 9:00
  - Below 20-day moving average at open

### Trend Following
- **Goal:** Enter after intraday trend is established
- **Logic:**
  - Price up > 1% from open
  - MA5 > MA20 (golden cross)
  - Volume ratio > 80%

---

## ⚙️ Configuration Example

Edit `config/settings.py` for key parameters:
```python
CONFIG = {
    'initial_capital': 10000000,  # Starting capital (KRW)
    'max_positions': 2,           # Max concurrent positions
    'position_size': 1000000,     # Per-position size
    'stop_loss': -2.0,            # Stop loss (%)
    'take_profit': 5.0,           # Take profit (%)
    'trailing_stop': 3.0,         # Trailing stop (%)
    'commission_rate': 0.015,     # Commission (%)
    'tax_rate': 0.18,             # Tax (%)
    'slippage_rate': 0.05,        # Slippage (%)
    'enable_market_filter': True, # Use market regime filter
}
```

---

## 🧪 Testing

Run all tests:
```bash
pytest tests/
```

---

## 📚 Documentation
- Each module and function includes docstrings for clarity.
- See `docs/` for strategy explanations and checklists.

---

## 📝 License

This project is licensed under the MIT License.

---

## 📬 Contact

For questions or collaboration, contact:
- **Name:** Zeu Park
- **Email:** parkzeu68

---

**⚠️ Disclaimer:** This system is for educational and research purposes only. Use at your own risk. Always validate strategies thoroughly before live trading. 
